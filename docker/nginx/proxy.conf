upstream backend_llama31_1b {
    server llama3.1-1b:6008;
}

upstream backend_llama31_8b_instruct {
    server llama3.1-8b-instruct:6018;
}

map $http_model_name $upstream_name {
    Llama3.1-1B backend_llama31_1b;
    Llama3.1-8B-Instuct backend_llama31_8b_instruct;
    default Llama3.1-1B;
}

server {
	listen 6006;
	server_name localhost;

	location / {
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_set_header X-Forwarded-Proto $scheme;

		proxy_buffering on;
		proxy_request_buffering on;
		tcp_nodelay on;

		proxy_pass http://$upstream_name$http_entry_point;
	}

}
